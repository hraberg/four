#!/bin/bash -e

PROJECT=four
CLOJURE_VERSION=1.5.0-alpha3

rm -rf target
lein jar

cd target
zip -q $PROJECT.jar -d "META-INF/maven*" "META-INF/leiningen*" "*.class"
cd classes
zip -q ../$PROJECT.jar $PROJECT.class
cd ..
ls -la *.jar
pack200  -G -Ustrip -r $PROJECT.jar
ls -la *.jar

if [ `ls -l $PROJECT.jar | awk '{print $5}'` -gt 4096 ]; then
   echo "$PROJECT.jar is too big"
   exit 1
fi

java -cp ~/.m2/repository/org/clojure/clojure/$CLOJURE_VERSION/clojure-$CLOJURE_VERSION.jar:$PROJECT.jar $PROJECT
